import{u as V,j as e,m as ee,i as O,F as se,a as te,d as E,b as _,c as q,e as ae,f as re,g as B,h as ne,k as oe,l as de,r as l,n as ie,o as le,p as ce,q as ue,s as pe,t as L,v as me,w as fe,x as he,C as xe}from"./index-BAsaUv6f.js";import{m as je,A as ge,s as ye,l as be,F as _e,f as ve,a as Ce,t as Se,b as Ne,c as Me,d as Ie,e as ke,g as De,h as $,E as K,D as W,i as Fe,j as Ee,k as Pe,n as we,u as T,S as Ae,L as Ue,B as Oe,p as qe,G as Be,P as Le}from"./deleteIcon-DXc6MpOL.js";const Y=["Baked","Boiled","Chopped","Diced","Dried","Fermented","Fried","Frosted","Grated","Grilled","Ground","Kneaded","Marinated","Roasted","Sauteed","Shredded","Sliced","Smoked","Soaked","Sprouted","Steamed","Stir-fried","Stuffed","Toasted","Whipped"],Q=["days","hours","minutes"],$e=q({name:re().required("Name is required"),preparations:ae().of(q({category:B().oneOf(Y,"Select a type from dropdown").required("Type is required"),timeAmount:ne().required("Time Amount is required").min(1,"Time Amount must be greater than 0"),timeUnits:B().oneOf(Q,"Select a type from dropdown").required("Time Unit is required")})).notRequired()}),Te={category:"",timeAmount:0,timeUnits:""},G={inputWrapper:["bg-white"]};function Ge({initialValues:t,isLoading:c,onClose:i,onCreate:o}){const s=V({initialValues:{name:(t==null?void 0:t.name)||"",preparations:(t==null?void 0:t.preparations)||[]},validationSchema:$e,onSubmit:n=>o(n,t==null?void 0:t._id)});return e.jsxs("form",{onSubmit:s.handleSubmit,autoComplete:"false",children:[e.jsxs(je,{children:[t?"Edit":"Add New"," Ingredient"]}),e.jsxs(ee,{children:[e.jsx(O,{autoFocus:!0,label:"Name",placeholder:"Onion, Tomato, Beans etc.",variant:"bordered",...s.getFieldProps("name"),isInvalid:s.touched.name&&!!s.errors.name,errorMessage:s.errors.name}),e.jsx("div",{className:"text-default-500 text-small",children:"Preparation Needed?"}),e.jsx(se,{value:s,children:e.jsx(te,{name:"preparations",children:({push:n,remove:d})=>e.jsxs(e.Fragment,{children:[s.values.preparations.map((v,a)=>{var C,S,u,p,m,N,M,f,I,k,h,D,F,x;return e.jsxs("div",{className:"bg-gray-100 flex flex-col gap-2 p-2 rounded-lg",children:[e.jsx(ge,{label:"Preparation type",placeholder:"Fried, Boiled, etc.",variant:"bordered",...s.getFieldProps(`preparations.${a}.category`),isInvalid:((S=(C=s.touched.preparations)==null?void 0:C[a])==null?void 0:S.category)&&!!(((u=s.errors.preparations)==null?void 0:u[a])||{}).category,errorMessage:(((p=s.errors.preparations)==null?void 0:p[a])||{}).category,classNames:G,options:Y,onSelect:j=>s.setFieldValue(`preparations.${a}.category`,j)}),e.jsx(O,{label:"Amount of time required",variant:"bordered",type:"number",...s.getFieldProps(`preparations.${a}.timeAmount`),isInvalid:((N=(m=s.touched.preparations)==null?void 0:m[a])==null?void 0:N.timeAmount)&&!!(((M=s.errors.preparations)==null?void 0:M[a])||{}).timeAmount,errorMessage:(I=((f=s.errors.preparations)==null?void 0:f[a])||{})==null?void 0:I.timeAmount,classNames:G}),e.jsx(ye,{label:"Time Unit",placeholder:"days, hours, minutes",variant:"bordered",selectedKeys:[s.values.preparations[a].timeUnits],...s.getFieldProps(`preparations.${a}.timeUnits`),isInvalid:((h=(k=s.touched.preparations)==null?void 0:k[a])==null?void 0:h.timeUnits)&&!!(((D=s.errors.preparations)==null?void 0:D[a])||{}).timeUnits,errorMessage:(x=((F=s.errors.preparations)==null?void 0:F[a])||{})==null?void 0:x.timeUnits,classNames:{trigger:["bg-white"]},children:Q.map(j=>e.jsx(be,{children:j},j))}),e.jsx(E,{}),e.jsx(_,{variant:"flat",onPress:()=>d(a),children:"Remove"})]},a)}),e.jsxs(_,{variant:"bordered",isDisabled:!!s.getFieldMeta("preparations").error,onPress:()=>n(Te),children:[e.jsx(_e,{icon:ve}),"Add Preparation"]})]})})})]}),e.jsxs(Ce,{children:[e.jsx(_,{color:"danger",variant:"light",onPress:i,isLoading:c,children:"Close"}),e.jsx(_,{type:"submit",color:"primary",isDisabled:!s.isValid,isLoading:c,children:"Submit"})]})]})}const Re=[{name:"Name",key:"name"},{name:"Updated By",key:"updatedBy"},{name:"Preparations needed?",key:"preparations"},{name:"",key:"actions"}];function Ke({data:t,onEdit:c,onDelete:i}){const o=(s,n)=>{const d=oe(s,n);switch(n){case"name":return d;case"updatedBy":return d==null?void 0:d.name;case"preparations":return d.length>0?"Yes":"No";case"actions":return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{content:"Edit",children:e.jsx("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>c(s),children:e.jsx(K,{})})}),e.jsx($,{content:"Delete",children:e.jsx("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>i(s._id),children:e.jsx(W,{})})})]});default:return null}};return e.jsxs(Se,{"aria-label":"ingredients-table",removeWrapper:!0,className:"mt-6",children:[e.jsx(Ne,{columns:Re,children:s=>e.jsx(Me,{children:s.name},s.key)}),e.jsx(Ie,{items:t,children:s=>e.jsx(ke,{children:n=>e.jsx(De,{children:o(s,n)})},s._id)})]})}function We({data:t,onEdit:c,onDelete:i}){return e.jsx(e.Fragment,{children:t.map(o=>{var s;return e.jsxs(Fe,{className:"mt-4",children:[e.jsx(Ee,{children:e.jsx("p",{className:"text-lg",children:o.name})}),e.jsx(E,{}),e.jsxs(Pe,{className:"flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-default-400",children:"Updated By"}),e.jsx("p",{children:(s=o.updatedBy)==null?void 0:s.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-default-400",children:"Preparations needed?"}),e.jsx("p",{children:o.preparations.length>0?"Yes":"No"})]})]}),e.jsx(E,{}),e.jsxs(we,{className:"justify-between",children:[e.jsxs("div",{className:"text-default-400 cursor-pointer active:opacity-50 flex items-center gap-1",onClick:()=>c(o),children:[e.jsx(K,{}),"Edit"]}),e.jsx(E,{orientation:"vertical"}),e.jsxs("div",{className:"text-danger cursor-pointer active:opacity-50 flex items-center gap-1",onClick:()=>i(o._id),children:[e.jsx(W,{}),"Delete"]})]})]})})})}function Ye(t){return de?e.jsx(Ke,{...t}):e.jsx(We,{...t})}const R=10;function He(){const[t,c]=l.useState(""),[i,o]=l.useState(1),[s,n]=l.useState(),d=ie(),{isLoading:v,isError:a,error:C,isSuccess:S,data:{data:u=[],count:p=0}={},refetch:m}=le({query:t,page:i}),[N,{isLoading:M,status:f}]=ce(),[I,{isLoading:k,status:h}]=ue(),[D,{isLoading:F,status:x}]=pe(),{isOpen:j,onOpen:P,onClose:A}=T(),{isOpen:z,onOpen:H,onClose:w}=T(),g=l.useCallback(()=>{A(),n(void 0)},[A]),y=l.useCallback(r=>{m(),d(L({message:`Ingredient ${r} successfully`,type:"success",autoClose:!0}))},[d,m]),b=l.useCallback(r=>{d(L({message:`Failed to ${r} ingredient`,type:"error",autoClose:!0}))},[d]),J=r=>{n(r),P()},X=r=>{n({_id:r}),H()},Z=r=>{D(r)};return l.useEffect(()=>{if(!v){const r=Math.ceil(p/R);i>r&&o(Math.max(1,r))}},[u,p,i,v]),l.useEffect(()=>{f==="fulfilled"?(g(),y("created")):f==="rejected"&&b("create")},[f,g,y,b]),l.useEffect(()=>{h==="fulfilled"?(g(),y("updated")):h==="rejected"&&b("update")},[h,g,y,b]),l.useEffect(()=>{x==="fulfilled"?(w(),n(void 0),y("deleted")):x==="rejected"&&b("delete")},[x,w,y,b]),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"max-w-[1024px] w-full px-6",children:[e.jsx("h1",{className:"text-2xl mb-6",children:"Ingredients"}),e.jsx(Ae,{name:"Ingredients",query:t,setQuery:c}),v&&e.jsx(Ue,{}),S&&(u.length===0?e.jsx(Oe,{name:"Ingredients",onAdd:P}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{data:u,onEdit:J,onDelete:X}),e.jsx("div",{className:"mt-4 flex justify-end mb-24 sm:mb-0",children:e.jsx(qe,{showControls:!0,total:Math.ceil(p/R),page:i,onChange:o})})]})),a&&e.jsx(Be,{errorMsg:me(C),onRetry:m}),e.jsxs(_,{color:"primary",variant:"shadow",className:"fixed bottom-8 right-8",onPress:P,children:[e.jsx(Le,{}),"Create"]}),e.jsx(fe,{isOpen:j,onClose:g,isDismissable:!1,isKeyboardDismissDisabled:!0,placement:"top-center",scrollBehavior:"outside",children:e.jsx(he,{children:()=>e.jsx(Ge,{initialValues:s,isLoading:M||k,onClose:g,onCreate:(r,U)=>{U?I({data:r,id:U}):N(r)}})})}),e.jsx(xe,{isModalOpen:z,onModalClose:w,onYesClick:()=>Z(s._id),isLoading:F,message:"Are you sure you want to delete this ingredient?"})]})})}export{He as default};
