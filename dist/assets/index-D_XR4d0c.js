import{r as c,R as Y,y as ge,z as me,j as e,$ as Z,A as J,B as fe,d as q,k as xe,l as ve,D as be,u as je,m as ye,i as V,F as _e,a as Se,b as A,c as Q,E as Ce,e as Ie,f as H,h as we,n as Le,G as Ee,H as Ne,I as Fe,t as ee,v as Pe,w as Re,x as Me}from"./index-BAsaUv6f.js";import{i as De,j as ze,k as ke,n as He,E as de,D as le,t as Ae,b as Te,c as $e,d as Be,e as We,g as qe,h as te,m as Oe,A as Ue,s as Ge,l as Qe,F as Ye,f as Ke,o as Xe,a as Ze,u as Je,S as Ve,L as et,B as tt,p as rt,G as nt,P as st}from"./deleteIcon-DXc6MpOL.js";function K(){return K=Object.assign?Object.assign.bind():function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var n in s)({}).hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},K.apply(null,arguments)}function at(t,r){if(t==null)return{};var s={};for(var n in t)if({}.hasOwnProperty.call(t,n)){if(r.indexOf(n)!==-1)continue;s[n]=t[n]}return s}var it=c.useLayoutEffect,ot=function(r){var s=Y.useRef(r);return it(function(){s.current=r}),s},re=function(r,s){if(typeof r=="function"){r(s);return}r.current=s},dt=function(r,s){var n=Y.useRef();return Y.useCallback(function(a){r.current=a,n.current&&re(n.current,null),n.current=s,s&&re(s,a)},[s])},ne={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},lt=function(r){Object.keys(ne).forEach(function(s){r.style.setProperty(s,ne[s],"important")})},se=lt,v=null,ae=function(r,s){var n=r.scrollHeight;return s.sizingStyle.boxSizing==="border-box"?n+s.borderSize:n-s.paddingSize};function ct(t,r,s,n){s===void 0&&(s=1),n===void 0&&(n=1/0),v||(v=document.createElement("textarea"),v.setAttribute("tabindex","-1"),v.setAttribute("aria-hidden","true"),se(v)),v.parentNode===null&&document.body.appendChild(v);var a=t.paddingSize,u=t.borderSize,l=t.sizingStyle,L=l.boxSizing;Object.keys(l).forEach(function(f){var I=f;v.style[I]=l[I]}),se(v),v.value=r;var g=ae(v,t);v.value=r,g=ae(v,t),v.value="x";var _=v.scrollHeight-a,b=_*s;L==="border-box"&&(b=b+a+u),g=Math.max(b,g);var m=_*n;return L==="border-box"&&(m=m+a+u),g=Math.min(m,g),[g,_]}var ie=function(){},ut=function(r,s){return r.reduce(function(n,a){return n[a]=s[a],n},{})},ht=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],pt=!!document.documentElement.currentStyle,gt=function(r){var s=window.getComputedStyle(r);if(s===null)return null;var n=ut(ht,s),a=n.boxSizing;if(a==="")return null;pt&&a==="border-box"&&(n.width=parseFloat(n.width)+parseFloat(n.borderRightWidth)+parseFloat(n.borderLeftWidth)+parseFloat(n.paddingRight)+parseFloat(n.paddingLeft)+"px");var u=parseFloat(n.paddingBottom)+parseFloat(n.paddingTop),l=parseFloat(n.borderBottomWidth)+parseFloat(n.borderTopWidth);return{sizingStyle:n,paddingSize:u,borderSize:l}},mt=gt;function X(t,r,s){var n=ot(s);c.useLayoutEffect(function(){var a=function(l){return n.current(l)};if(t)return t.addEventListener(r,a),function(){return t.removeEventListener(r,a)}},[])}var ft=function(r,s){X(document.body,"reset",function(n){r.current.form===n.target&&s(n)})},xt=function(r){X(window,"resize",r)},vt=function(r){X(document.fonts,"loadingdone",r)},bt=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],jt=function(r,s){var n=r.cacheMeasurements,a=r.maxRows,u=r.minRows,l=r.onChange,L=l===void 0?ie:l,g=r.onHeightChange,_=g===void 0?ie:g,b=at(r,bt),m=b.value!==void 0,f=c.useRef(null),I=dt(f,s),F=c.useRef(0),o=c.useRef(),d=function(){var i=f.current,j=n&&o.current?o.current:mt(i);if(j){o.current=j;var x=ct(j,i.value||i.placeholder||"x",u,a),S=x[0],C=x[1];F.current!==S&&(F.current=S,i.style.setProperty("height",S+"px","important"),_(S,{rowHeight:C}))}},h=function(i){m||d(),L(i)};return c.useLayoutEffect(d),ft(f,function(){if(!m){var p=f.current.value;requestAnimationFrame(function(){var i=f.current;i&&p!==i.value&&d()})}}),xt(d),vt(d),c.createElement("textarea",K({},b,{onChange:h,ref:I}))},yt=c.forwardRef(jt),ce=ge(({style:t,minRows:r=3,maxRows:s=8,cacheMeasurements:n=!1,disableAutosize:a=!1,onHeightChange:u,...l},L)=>{const{Component:g,label:_,description:b,startContent:m,endContent:f,hasHelper:I,shouldLabelBeOutside:F,shouldLabelBeInside:o,isInvalid:d,errorMessage:h,getBaseProps:p,getLabelProps:i,getInputProps:j,getInnerWrapperProps:x,getInputWrapperProps:S,getHelperWrapperProps:C,getDescriptionProps:E,getErrorMessageProps:N,isClearable:R,getClearButtonProps:y}=me({...l,ref:L,isMultiline:!0}),[M,T]=c.useState(r>1),[$,B]=c.useState(!1),z=_?e.jsx("label",{...i(),children:_}):null,P=j(),W=(U,G)=>{if(r===1&&T(U>=G.rowHeight*2),s>r){const pe=U>=s*G.rowHeight;B(pe)}u==null||u(U,G)},k=a?e.jsx("textarea",{...P,style:Z(P.style,t??{})}):e.jsx(yt,{...P,cacheMeasurements:n,"data-hide-scroll":J(!$),maxRows:s,minRows:r,style:Z(P.style,t??{}),onHeightChange:W}),w=c.useMemo(()=>R?e.jsx("button",{...y(),children:e.jsx(fe,{})}):null,[R,y]),O=c.useMemo(()=>m||f?e.jsxs("div",{...x(),children:[m,k,f]}):e.jsx("div",{...x(),children:k}),[m,P,f,x]),D=d&&h,he=D||b;return e.jsxs(g,{...p(),children:[F?z:null,e.jsxs("div",{...S(),"data-has-multiple-rows":J(M),children:[o?z:null,O,w]}),I&&he?e.jsx("div",{...C(),children:D?e.jsx("div",{...N(),children:h}):e.jsx("div",{...E(),children:b})}):null]})});ce.displayName="HeroUI.Textarea";var _t=ce;function St({data:t,onEdit:r,onDelete:s}){return e.jsx(e.Fragment,{children:t.map(n=>e.jsxs(De,{className:"mt-4",children:[e.jsx(ze,{children:e.jsx("p",{className:"text-lg",children:n.name})}),e.jsx(q,{}),e.jsxs(ke,{className:"flex-row justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-default-400",children:"Updated By"}),e.jsx("p",{children:n.updatedBy.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-default-400",children:"Ingredients available?"}),e.jsx("p",{children:n.ingredients.length>0?"Yes":"No"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-default-400",children:"Recipe available?"}),e.jsx("p",{children:n.recipe?"Yes":"No"})]})]}),e.jsx(q,{}),e.jsxs(He,{className:"justify-between",children:[e.jsxs("div",{className:"text-default-400 cursor-pointer active:opacity-50 flex items-center gap-1",onClick:()=>r(n),children:[e.jsx(de,{}),"Edit"]}),e.jsx(q,{orientation:"vertical"}),e.jsxs("div",{className:"text-danger cursor-pointer active:opactiy-50 flex items-center gap-1",onClick:()=>s(n._id),children:[e.jsx(le,{}),"Delete"]})]})]}))})}const Ct=[{name:"Name",key:"name"},{name:"Updated By",key:"updatedBy"},{name:"Ingredients available?",key:"ingredients"},{name:"Recipe available?",key:"recipe"},{name:"",key:"actions"}];function It({data:t,onEdit:r,onDelete:s}){const n=(a,u)=>{const l=xe(a,u);switch(u){case"name":return l;case"updatedBy":return l==null?void 0:l.name;case"ingredients":return l.length>0?"Yes":"No";case"recipe":return l?"Yes":"No";case"actions":return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{content:"Edit",children:e.jsx("span",{className:"text-lg text-default-400 cursor-pointer active:opacity-50",onClick:()=>r(a),children:e.jsx(de,{})})}),e.jsx(te,{content:"Delete",children:e.jsx("span",{className:"text-lg text-danger cursor-pointer active:opacity-50",onClick:()=>s(a._id),children:e.jsx(le,{})})})]});default:return null}};return e.jsxs(Ae,{"aria-label":"dishes-table",removeWrapper:!0,className:"mt-6",children:[e.jsx(Te,{columns:Ct,children:a=>e.jsx($e,{children:a.name},a.key)}),e.jsx(Be,{items:t,children:a=>e.jsx(We,{children:u=>e.jsx(qe,{children:n(a,u)})},a._id)})]})}function wt(t){return ve?e.jsx(It,{...t}):e.jsx(St,{...t})}function Lt(t,r=1e3){let s;const n=this;return function(...a){clearTimeout(s),s=setTimeout(()=>t.apply(n,a),r)}}const ue=["cup","tablespoon","teaspoon","gm","ml"],Et=Q({name:H().required("Name is required"),recipe:H(),ingredients:Ie().of(Q({ingredient:Q({_id:H().required("Ingredient is required"),name:H()}),amount:we().required("Amount is required").min(1,"Amount must be greater than 0"),measurement_unit:H().oneOf(ue,"Select a type from dropdown").required("Measurement Unit is required")})).max(100).notRequired(),isPrivate:Ce()}),Nt={ingredient:{_id:"",name:""},amount:0,measurement_unit:""},Ft={query:"",page:1},oe={inputWrapper:["bg-white"]},Pt=t=>({...t,ingredients:t.ingredients.map(r=>({...r,ingredient:{_id:r.ingredient._id,name:r.ingredient.name}}))});function Rt({initialValues:t,isLoading:r,onClose:s,onCreate:n}){const a=c.useMemo(()=>t?Pt(t):void 0,[t]),[u,l]=c.useState((t==null?void 0:t.ingredients.map(d=>({query:d.ingredient.name,page:1})))??[]),[L,g]=c.useState((t==null?void 0:t.ingredients.map(d=>[d.ingredient]))||[]),_=c.useRef(0),[b]=be(),m=c.useCallback(async()=>{const d=Array(u.length),h=++_.current,p=u.map(async(i,j)=>{const{data:x}=await b(i);d[j]=(x==null?void 0:x.data)??[]});await Promise.all(p),_.current===h&&g(d)},[b,u]),f=c.useMemo(()=>Lt((d,h)=>{const p=u.map((i,j)=>j===h?{query:d,page:1}:i);l(p)},750),[u]);function I(d){return d.map(h=>({_id:h._id,name:h.name,description:h.preparations.length===0?"":h.preparations.map(F).join(", ")}))}function F(d){function h(p){switch(p){case"days":return"d";case"minutes":return"min";case"hours":return"h";default:return p}}return d.category+":"+d.timeAmount+h(d.timeUnits)}const o=je({initialValues:{name:(a==null?void 0:a.name)||"",recipe:(a==null?void 0:a.recipe)||"",ingredients:(a==null?void 0:a.ingredients)||[],isPrivate:(a==null?void 0:a.isPrivate)||!1},validationSchema:Et,onSubmit:d=>n(d,t==null?void 0:t._id)});return c.useEffect(()=>{(async function(){await m()})()},[u,m]),e.jsxs("form",{onSubmit:o.handleSubmit,autoComplete:"false",children:[e.jsxs(Oe,{children:[t?"Edit":"Add New"," Dish"]}),e.jsxs(ye,{children:[e.jsx(V,{autoFocus:!0,label:"Name",placeholder:"Insert Dish names etc.",variant:"bordered",...o.getFieldProps("name"),isInvalid:o.touched.name&&!!o.errors.name,errorMessage:o.errors.name}),e.jsx(_t,{label:"Recipe",placeholder:"Insert recipe",variant:"bordered",...o.getFieldProps("recipe"),isInvalid:o.touched.recipe&&!!o.errors.recipe,errorMessage:o.errors.recipe}),e.jsx("div",{className:"text-default-500 text-small",children:"Ingredients Needed?"}),e.jsx(_e,{value:o,children:e.jsx(Se,{name:"ingredients",children:({push:d,remove:h})=>e.jsxs(e.Fragment,{children:[o.values.ingredients.map((p,i)=>{var j,x,S,C,E,N,R,y,M,T,$,B,z,P,W,k;return e.jsxs("div",{className:"bg-gray-100 flex flex-col gap-2 p-2 rounded-lg",children:[e.jsx(Ue,{label:"Ingredient",placeholder:"Chana, Coriander, etc.",variant:"bordered",...o.getFieldProps(`ingredients.${i}.ingredient`),isInvalid:((x=(j=o.touched.ingredients)==null?void 0:j[i])==null?void 0:x.ingredient)&&!!((C=(((S=o.errors.ingredients)==null?void 0:S[i])||{}).ingredient)!=null&&C._id),errorMessage:(N=(((E=o.errors.ingredients)==null?void 0:E[i])||{}).ingredient)==null?void 0:N._id,classNames:oe,value:o.values.ingredients[i].ingredient.name,options:I(L[i]),onChange:w=>f(w.target.value,i),onSelect:w=>o.setFieldValue(`ingredients.${i}.ingredient._id`,w)}),e.jsx(V,{label:"Amount of ingredient",variant:"bordered",type:"number",...o.getFieldProps(`ingredients.${i}.amount`),isInvalid:((y=(R=o.touched.ingredients)==null?void 0:R[i])==null?void 0:y.amount)&&!!(((M=o.errors.ingredients)==null?void 0:M[i])||{}).amount,errorMessage:($=((T=o.errors.ingredients)==null?void 0:T[i])||{})==null?void 0:$.amount,classNames:oe}),e.jsx(Ge,{label:"Measurement Unit",placeholder:"cups, tablespoons, grams, etc.",variant:"bordered",selectedKeys:[o.values.ingredients[i].measurement_unit],...o.getFieldProps(`ingredients.${i}.measurement_unit`),isInvalid:((z=(B=o.touched.ingredients)==null?void 0:B[i])==null?void 0:z.measurement_unit)&&!!(((P=o.errors.ingredients)==null?void 0:P[i])||{}).measurement_unit,errorMessage:(k=((W=o.errors.ingredients)==null?void 0:W[i])||{})==null?void 0:k.measurement_unit,classNames:{trigger:["bg-white"]},children:ue.map(w=>e.jsx(Qe,{children:w},w))}),e.jsx(q,{}),e.jsx(A,{variant:"flat",onPress:()=>{l(w=>w.filter((O,D)=>D!==i)),g(w=>w.filter((O,D)=>D!==i)),h(i)},children:"Remove"})]},i)}),e.jsxs(A,{variant:"bordered",isDisabled:!!o.getFieldMeta("ingredients").error,onPress:()=>{l(p=>[...p,Ft]),g(p=>[...p,[]]),d(Nt)},children:[e.jsx(Ye,{icon:Ke}),"Add Ingredient"]})]})})}),e.jsx(Xe,{...o.getFieldProps("isPrivate"),children:"Make Private"}),e.jsxs(Ze,{children:[e.jsx(A,{color:"danger",variant:"light",onPress:s,isLoading:r,children:"Close"}),e.jsx(A,{type:"submit",color:"primary",isDisabled:!(o.dirty&&o.isValid),isLoading:r,children:"Submit"})]})]})]})}const Mt=10;function kt(){const[t,r]=c.useState(""),[s,n]=c.useState(1),[a,u]=c.useState(),l=Le(),{isLoading:L,isError:g,error:_,isSuccess:b,data:{data:m=[],count:f=0}={},refetch:I}=Ee({query:t,page:s}),{isOpen:F,onOpen:o,onClose:d}=Je(),[h,{isLoading:p,status:i}]=Ne(),[j,{isLoading:x,status:S}]=Fe(),C=c.useCallback(()=>{d(),u(void 0)},[d]),E=c.useCallback(y=>{I(),l(ee({message:`Dish ${y} successfully`,type:"success",autoClose:!0}))},[l,I]),N=c.useCallback(y=>{l(ee({message:`Failed to ${y} dish`,type:"error",autoClose:!0}))},[l]),R=y=>{u(y),o()};return c.useEffect(()=>{i==="fulfilled"?(C(),E("created")):i==="rejected"&&N("create")},[i,C,E,N]),c.useEffect(()=>{S==="fulfilled"?(C(),E("updated")):S==="rejected"&&N("update")},[S,C,E,N]),e.jsx("div",{className:"flex justify-center",children:e.jsxs("div",{className:"max-w-[1024px] w-full px-6",children:[e.jsx("h1",{className:"text-2xl",children:"Dishes"}),e.jsx(Ve,{name:"Ingredients",query:t,setQuery:r}),L&&e.jsx(et,{}),b&&(m.length===0?e.jsx(tt,{name:"Dishes",onAdd:o}):e.jsxs(e.Fragment,{children:[e.jsx(wt,{data:m,onEdit:R,onDelete:()=>console.log("UnImplemented")}),e.jsx("div",{className:"mt-4 flex justify-end mb-24 sm:mb-0",children:e.jsx(rt,{showControls:!0,total:Math.ceil(f/Mt),page:s,onChange:n})})]})),g&&e.jsx(nt,{errorMsg:Pe(_),onRetry:I}),e.jsxs(A,{color:"primary",variant:"shadow",className:"fixed bottom-8 right-8",onPress:o,children:[e.jsx(st,{}),"Create"]}),e.jsx(Re,{isOpen:F,onClose:C,isDismissable:!1,isKeyboardDismissDisabled:!0,placement:"top-center",scrollBehavior:"outside",children:e.jsx(Me,{children:()=>e.jsx(Rt,{initialValues:a,isLoading:p||x,onClose:C,onCreate:(y,M)=>{M?j({data:y,id:M}):h(y)}})})})]})})}export{kt as default};
